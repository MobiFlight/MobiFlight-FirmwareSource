; PlatformIO Project Configuration File
;
; Supported boards for the MobiFlight firmware are:
; Arduino Mega (megaatmega2560)
; Arduino Pro Micro (sparkfun_promicro16)
; Arduino Uno (uno)
; Raspberry Pi Pico (pico)
;
; Version numbers for releases are automatically applied by GitHub
; during the release build process based on the tag associated with
; the GitHub release.

; default_envs is set up to build all platforms on Windows machines
; by default. The GitHub build process overrides this to build
; all platforms on Linux. When adding new platforms the GitHub
; build scripts in .github/workflows need to be updated as well
; to include the new platforms.
[platformio]
;default_envs = mega, micro, uno, pico_windows
default_envs = mega, micro, uno, pico_linux ; Uncomment this line to build all platforms on Linux

; Common build settings across all devices
[env]
lib_deps = 
	arduino-libraries/Servo @ 1.1.8
	https://github.com/MobiFlight/LedControl#1.1.0
	waspinator/AccelStepper @ 1.61
	https://github.com/MobiFlight/LiquidCrystal_I2C#v1.1.4
	https://github.com/MobiFlight/Arduino-CmdMessenger#4.2.1
build_flags =
	-DMF_REDUCE_FUNCT_LEDCONTROL
	-DMAXCALLBACKS=30
	-DSERIAL_RX_BUFFER_SIZE=96
	-DMESSENGERBUFFERSIZE=96
	-DMAXSTREAMBUFFERSIZE=96
	-DDEFAULT_TIMEOUT=5000
src_filter =
	+<*>
extra_scripts =
	pre:get_version.py

; Build settings for the Arduino Mega
[env:mega]
platform = atmelavr
board = megaatmega2560
framework = arduino
build_flags = 
	${env.build_flags}
	-I./_Boards/Atmel/Board_Mega
src_filter = 
	${env.src_filter}
	+<../_Boards/Atmel>
lib_deps = 
	${env.lib_deps}	
monitor_speed = 115200
extra_scripts = 
	${env.extra_scripts}

; Build settings for the Arduino Pro Micro
[env:micro]
platform = atmelavr
board = sparkfun_promicro16
framework = arduino
build_flags = 
	${env.build_flags}
	-I./_Boards/Atmel/Board_ProMicro
src_filter = 
	${env.src_filter}
	+<../_Boards/Atmel>
lib_deps = 
	${env.lib_deps}	
monitor_speed = 115200
extra_scripts = 
	${env.extra_scripts}

; Build settings for the Arduino Uno
[env:uno]
platform = atmelavr
board = uno
framework = arduino
build_flags = 
	${env.build_flags}
	-I./_Boards/Atmel/Board_Uno
src_filter = 
	${env.src_filter}
	+<../_Boards/Atmel>
lib_deps = 
	${env.lib_deps}	
monitor_speed = 115200
extra_scripts = 
	${env.extra_scripts}

; Base build settings for the Raspberry Pi Pico regardless of build environment
[pico_base]
platform = https://github.com/maxgerhardt/platform-raspberrypi.git
board = pico
framework = arduino
board_build.core = earlephilhower
board_build.filesystem_size = 0M
lib_ldf_mode = chain+
build_flags =
	${env.build_flags}
	-I./_Boards/RaspberryPi/Pico
	-fpermissive
src_filter =
	${env.src_filter}
	+<../_Boards/RaspberryPi>
lib_deps =
	https://github.com/MobiFlight/LedControl#1.1.0
	waspinator/AccelStepper @ 1.61
	https://github.com/MobiFlight/LiquidCrystal_I2C#v1.1.4
	https://github.com/MobiFlight/Arduino-CmdMessenger#4.2.1
extra_scripts = 
	${env.extra_scripts}

; Build settings for the Raspberry Pi Pico in a Windows build environment
[env:pico_windows]
extends = pico_base
platform_packages =
    maxgerhardt/framework-arduinopico@https://github.com/earlephilhower/arduino-pico.git
    maxgerhardt/toolchain-pico@https://github.com/earlephilhower/pico-quick-toolchain/releases/download/1.3.1-a/x86_64-w64-mingw32.arm-none-eabi-7855b0c.210706.zip

; Build settings for the Raspberry Pi Pico in a Linux build environment
[env:pico_linux]
extends = pico_base
platform_packages =
	maxgerhardt/framework-arduinopico@https://github.com/earlephilhower/arduino-pico.git
	maxgerhardt/toolchain-pico@https://github.com/earlephilhower/pico-quick-toolchain/releases/download/1.3.1-a/x86_64-linux-gnu.arm-none-eabi-7855b0c.210706.tar.gz